<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ë°ì´í„° ì—…ë¡œë“œ & ë‹¤ìš´ë¡œë“œ</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 min-h-screen p-8">
  <div class="max-w-5xl mx-auto bg-white p-8 rounded-2xl shadow-xl space-y-12">

    <!-- ì—…ë¡œë“œ ì˜ì—­ -->
    <section>
      <h2 class="text-2xl font-bold text-blue-700 mb-4">ğŸ“„ ë°ì´í„° ì—…ë¡œë“œ</h2>
      <form id="uploadForm" class="space-y-4">
        <input type="file" id="fileInput" class="w-full border px-4 py-2 rounded" multiple required>
        <input type="text" id="titleInput" class="w-full border px-4 py-2 rounded" placeholder="ê³µí†µ íƒ€ì´íŒ… (ì„ íƒ)">
        <textarea id="descInput" rows="3" class="w-full border px-4 py-2 rounded" placeholder="ê³µí†µ ì„¤ëª… (ì„ íƒ)"></textarea>
        <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">ì—…ë¡œë“œí•˜ê¸°</button>
      </form>

      <!-- ì—…ë¡œë“œ ë©”ì‹œì§€ -->
      <div id="uploadMessage" class="mt-4 text-green-700 font-medium"></div>

      <!-- ê²€ìƒ‰, ì •ë ¬, í•„í„° ë©”ë‰´ -->
      <div class="flex flex-wrap gap-4 items-center justify-between mt-6 mb-4">
        <input type="text" id="searchInput" placeholder="íŒŒì¼ëª… ë˜ëŠ” ì œëª©ìœ¼ë¡œ ê²€ìƒ‰..." class="border px-3 py-2 rounded w-full sm:w-1/3">
        <select id="sortSelect" class="border px-3 py-2 rounded">
          <option value="name">íŒŒì¼ëª…ìˆœ ì •ë ¬</option>
          <option value="recent">ìµœê·¼ ì—…ë¡œë“œìˆœ</option>
        </select>
        <select id="dateFilter" class="border px-3 py-2 rounded">
          <option value="all">ëª¨ë“  ë‚ ì§œ</option>
          <option value="today">ì˜¤ëŠ˜</option>
          <option value="week">ì´ë²ˆ ì£¼</option>
        </select>
        <select id="typeFilter" class="border px-3 py-2 rounded">
          <option value="all">ì „ì²´ íŒŒì¼</option>
          <option value="xlsx">ì—‘ì…€(.xlsx)</option>
          <option value="hwp">í•œê¸€(.hwp)</option>
          <option value="jpg">ì´ë¯¸ì§€(.jpg)</option>
        </select>
      </div>

      <!-- ì—…ë¡œë“œëœ íŒŒì¼ ëª©ë¡ -->
      <div id="uploadList" class="space-y-4"></div>

      <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
      <div id="pagination" class="mt-6 flex justify-center gap-2"></div>
    </section>

    <!-- ê¸°ì¡´ ì„œë²„ ë°ì´í„° ë‹¤ìš´ë¡œë“œ ì˜ì—­ -->
    <section>
      <h2 class="text-2xl font-bold text-green-700 mb-4">ğŸ“ ê¸°ì¡´ ë°ì´í„° ë‹¤ìš´ë¡œë“œ</h2>
      <div id="downloadList" class="space-y-4">
        <!-- ë¯¸ë¦¬ ì •ì˜ëœ ë‹¤ìš´ë¡œë“œ íŒŒì¼ ëª©ë¡ -->
      </div>
    </section>

  </div>

  <script>
    const uploadForm = document.getElementById('uploadForm');
    const fileInput = document.getElementById('fileInput');
    const titleInput = document.getElementById('titleInput');
    const descInput = document.getElementById('descInput');
    const uploadList = document.getElementById('uploadList');
    const downloadList = document.getElementById('downloadList');
    const searchInput = document.getElementById('searchInput');
    const sortSelect = document.getElementById('sortSelect');
    const dateFilter = document.getElementById('dateFilter');
    const typeFilter = document.getElementById('typeFilter');
    const uploadMessage = document.getElementById('uploadMessage');
    const pagination = document.getElementById('pagination');

    let uploadedItems = [];
    let currentPage = 1;
    const itemsPerPage = 6;

    function renderUploads() {
      const keyword = searchInput.value.toLowerCase();
      const sortBy = sortSelect.value;
      const dateValue = dateFilter.value;
      const typeValue = typeFilter.value;

      let filtered = [...uploadedItems];

      filtered = filtered.filter(item =>
        (item.file.name && item.file.name.toLowerCase().includes(keyword)) ||
        (item.title && item.title.toLowerCase().includes(keyword))
      );

      const now = new Date();
      filtered = filtered.filter(item => {
        const uploadTime = new Date(item.time);
        if (dateValue === "today") {
          return uploadTime.toDateString() === now.toDateString();
        } else if (dateValue === "week") {
          const diff = now - uploadTime;
          return diff <= 7 * 24 * 60 * 60 * 1000;
        }
        return true;
      });

      if (typeValue !== "all") {
        filtered = filtered.filter(item =>
          item.file.name.toLowerCase().endsWith(`.${typeValue}`)
        );
      }

      if (sortBy === 'name') {
        filtered.sort((a, b) => a.file.name.localeCompare(b.file.name));
      } else if (sortBy === 'recent') {
        filtered.sort((a, b) => b.time - a.time);
      }

      const totalPages = Math.ceil(filtered.length / itemsPerPage);
      if (currentPage > totalPages) currentPage = totalPages || 1;

      const start = (currentPage - 1) * itemsPerPage;
      const end = start + itemsPerPage;
      const paginatedItems = filtered.slice(start, end);

      uploadList.innerHTML = '';
      paginatedItems.forEach(item => {
        const fileURL = URL.createObjectURL(item.file);
        let preview = '';

        if (item.file.type.startsWith('image/')) {
          preview = `<img src="${fileURL}" alt="ë¯¸ë¦¬ë³´ê¸°" class="w-full max-w-xs rounded mb-2" />`;
        }

        const card = document.createElement('div');
        card.className = "border p-4 rounded shadow bg-white";
        card.innerHTML = `
          ${preview}
          <p class="font-semibold text-gray-800">${item.title}</p>
          <p class="text-sm text-gray-600">${item.desc}</p>
          <p class="text-xs text-gray-400">${item.file.name}</p>
          <a href="${fileURL}" download="${item.file.name}" class="mt-2 inline-block bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded">
            â¬‡ï¸ ë‹¤ìš´ë¡œë“œ
          </a>
        `;

        uploadList.appendChild(card);
      });

      // í˜ì´ì§€ë„¤ì´ì…˜ ë²„íŠ¼ ë Œë”ë§
      pagination.innerHTML = '';
      for (let i = 1; i <= totalPages; i++) {
        const btn = document.createElement('button');
        btn.textContent = i;
        btn.className = `px-3 py-1 rounded ${i === currentPage ? 'bg-blue-500 text-white' : 'bg-gray-200'} hover:bg-blue-400`;
        btn.addEventListener('click', () => {
          currentPage = i;
          renderUploads();
        });
        pagination.appendChild(btn);
      }
    }

    uploadForm.addEventListener('submit', function (e) {
      e.preventDefault();

      const files = Array.from(fileInput.files);
      const title = titleInput.value || "(ì œëª© ì—†ìŒ)";
      const desc = descInput.value || "(ì„¤ëª… ì—†ìŒ)";

      files.forEach(file => {
        uploadedItems.push({
          file,
          title,
          desc,
          time: Date.now()
        });
      });

      uploadMessage.textContent = `${files.length}ê°œì˜ íŒŒì¼ì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.`;
      currentPage = 1;
      renderUploads();
      uploadForm.reset();

      setTimeout(() => {
        uploadMessage.textContent = '';
      }, 4000);
    });

    searchInput.addEventListener('input', () => { currentPage = 1; renderUploads(); });
    sortSelect.addEventListener('change', () => { currentPage = 1; renderUploads(); });
    dateFilter.addEventListener('change', () => { currentPage = 1; renderUploads(); });
    typeFilter.addEventListener('change', () => { currentPage = 1; renderUploads(); });

    const fixedFiles = [
      { name: "ì§€ì—­í†µê³„_2024.xlsx", url: "/data/ì§€ì—­í†µê³„_2024.xlsx" },
      { name: "ë¬¸í™”ì¡°ì‚¬ë³´ê³ ì„œ.hwp", url: "/data/ë¬¸í™”ì¡°ì‚¬ë³´ê³ ì„œ.hwp" },
      { name: "ì „í†µì‹œì¥_ì‚¬ì§„.jpg", url: "/data/ì „í†µì‹œì¥_ì‚¬ì§„.jpg" }
    ];

    fixedFiles.forEach(file => {
      const item = document.createElement('div');
      item.className = "border p-4 rounded shadow bg-white flex items-center justify-between";
      item.innerHTML = `
        <span class="font-medium text-gray-800">${file.name}</span>
        <a href="${file.url}" download class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded">
          â¬‡ï¸ ë‹¤ìš´ë¡œë“œ
        </a>
      `;
      downloadList.appendChild(item);
    });
  </script>
</body>
</html>
